---
import { type ITrendingItem } from "./TrendingList.astro";
import "../styles/global.css";

interface Props {
  itemInfo: ITrendingItem;
}

const { itemInfo } = Astro.props;
const {
  indexLabel,
  authorName,
  publicationLogo,
  authorLogo,
  isBookAuthor,
  isStarAuthor,
  isMemberOnly,
  articleTitle,
  publicationName,
  date,
  readTime,
  authorInfo,
  authorFollowersNum,
} = itemInfo;
---

<li class="flex gap-4">
  <p class="text-[32px] text-[#EBEDF0] tracking-tight">{indexLabel}</p>
  <div>
    <div class="flex items-center mb-2 pt-3">
      <a href="#">
        <img
          src={publicationLogo ? publicationLogo : authorLogo}
          alt="publication-logo"
          class={`w-5 me-2 ${publicationLogo ? "rounded" : "rounded-full"}`}
        />
      </a>
      <div class="text-[13px] text-gray-600 flex items-center">
        <div class="flex items-center me-1 relative">
          <a
            href="#"
            class="font-medium text-black author-name"
            data-authorName={authorName}
          >
            {authorName}
          </a>
          <span class={isBookAuthor ? "" : "hidden"}>
            <svg
              width="24"
              height="24"
              viewBox="0 0 16 16"
              fill="none"
              class="w-4"
            >
              <path
                d="M15.16 8c0 .65-.46 1.14-.86 1.57-.23.25-.47.5-.56.72-.1.22-.09.55-.1.88 0 .6-.01 1.3-.48 1.78-.48.48-1.16.5-1.75.5-.32 0-.65.01-.86.1-.2.07-.46.33-.7.57-.42.41-.9.88-1.54.88s-1.12-.47-1.54-.88a2.87 2.87 0 0 0-.7-.58c-.22-.09-.54-.08-.87-.09-.59 0-1.27-.02-1.74-.5s-.48-1.17-.49-1.78c0-.33-.01-.67-.1-.88-.07-.2-.32-.47-.55-.71-.4-.44-.87-.93-.87-1.58s.46-1.14.87-1.58c.23-.24.47-.5.56-.71.09-.22.08-.55.09-.88 0-.6.02-1.3.49-1.78s1.15-.5 1.74-.5c.33 0 .66-.01.86-.1.2-.08.47-.33.7-.57.43-.41.91-.88 1.55-.88.63 0 1.12.47 1.54.88.24.24.49.48.7.58.22.09.54.08.86.09.6 0 1.27.02 1.75.5.47.48.48 1.17.49 1.78 0 .33 0 .67.09.88.08.2.33.47.56.71.4.44.86.93.86 1.58z"
                fill="#437AFF"></path>
              <path
                d="M7.33 10.5c.2 0 .38.08.52.22.13.14.21.33.21.53 0 .07.03.13.07.18a.24.24 0 0 0 .35 0 .25.25 0 0 0 .07-.18c0-.2.08-.39.22-.53a.73.73 0 0 1 .52-.22h1.96c.13 0 .25-.05.34-.15a.5.5 0 0 0 .15-.35V6a.5.5 0 0 0-.15-.35.48.48 0 0 0-.34-.15H9.78c-.33 0-.64.13-.87.37-.23.23-.36.55-.36.88v2.5c0 .07-.02.13-.07.18a.24.24 0 0 1-.35 0 .25.25 0 0 1-.07-.18v-2.5c0-.33-.13-.65-.36-.88a1.21 1.21 0 0 0-.86-.37H5.37a.48.48 0 0 0-.35.15.5.5 0 0 0-.14.35v4c0 .13.05.26.14.35.1.1.22.15.35.15h1.96z"
                fill="#fff"></path>
            </svg>
          </span>
          <div
            data-authorInfo={authorName}
            class={`w-80 bg-white text-black rounded-md absolute z-10 hidden author-info `}
          >
            <div data-authorInfo-speechBubble={authorName} class={`p-4 `}>
              <div>
                <a href="#">
                  <div class="flex items-center gap-2 mb-2">
                    <div class="relative">
                      <img
                        src={authorLogo}
                        loading="lazy"
                        alt=""
                        class="w-8 rounded-full"
                      />
                      <span class={`${isStarAuthor ? "" : "hidden"}`}>
                        <svg
                          width="20"
                          height="20"
                          viewBox="0 0 20 20"
                          fill="none"
                          class="absolute -top-2 -right-2"
                        >
                          <path
                            d="M12.4 12.77l-1.81 4.99a.63.63 0 0 1-1.18 0l-1.8-4.99a.63.63 0 0 0-.38-.37l-4.99-1.81a.62.62 0 0 1 0-1.18l4.99-1.8a.63.63 0 0 0 .37-.38l1.81-4.99a.63.63 0 0 1 1.18 0l1.8 4.99a.63.63 0 0 0 .38.37l4.99 1.81a.63.63 0 0 1 0 1.18l-4.99 1.8a.63.63 0 0 0-.37.38z"
                            fill="#FFC017"></path>
                        </svg>
                      </span>
                    </div>
                    <p class="text-lg font-semibold">{authorName}</p>
                  </div>
                </a>
                <div
                  class={`flex items-center mb-2 ${
                    isBookAuthor ? "" : "hidden"
                  }`}
                >
                  <span class="me-1">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 16 16"
                      fill="none"
                      class="w-5"
                    >
                      <path
                        d="M15.16 8c0 .65-.46 1.14-.86 1.57-.23.25-.47.5-.56.72-.1.22-.09.55-.1.88 0 .6-.01 1.3-.48 1.78-.48.48-1.16.5-1.75.5-.32 0-.65.01-.86.1-.2.07-.46.33-.7.57-.42.41-.9.88-1.54.88s-1.12-.47-1.54-.88a2.87 2.87 0 0 0-.7-.58c-.22-.09-.54-.08-.87-.09-.59 0-1.27-.02-1.74-.5s-.48-1.17-.49-1.78c0-.33-.01-.67-.1-.88-.07-.2-.32-.47-.55-.71-.4-.44-.87-.93-.87-1.58s.46-1.14.87-1.58c.23-.24.47-.5.56-.71.09-.22.08-.55.09-.88 0-.6.02-1.3.49-1.78s1.15-.5 1.74-.5c.33 0 .66-.01.86-.1.2-.08.47-.33.7-.57.43-.41.91-.88 1.55-.88.63 0 1.12.47 1.54.88.24.24.49.48.7.58.22.09.54.08.86.09.6 0 1.27.02 1.75.5.47.48.48 1.17.49 1.78 0 .33 0 .67.09.88.08.2.33.47.56.71.4.44.86.93.86 1.58z"
                        fill="#437AFF"></path>
                      <path
                        d="M7.33 10.5c.2 0 .38.08.52.22.13.14.21.33.21.53 0 .07.03.13.07.18a.24.24 0 0 0 .35 0 .25.25 0 0 0 .07-.18c0-.2.08-.39.22-.53a.73.73 0 0 1 .52-.22h1.96c.13 0 .25-.05.34-.15a.5.5 0 0 0 .15-.35V6a.5.5 0 0 0-.15-.35.48.48 0 0 0-.34-.15H9.78c-.33 0-.64.13-.87.37-.23.23-.36.55-.36.88v2.5c0 .07-.02.13-.07.18a.24.24 0 0 1-.35 0 .25.25 0 0 1-.07-.18v-2.5c0-.33-.13-.65-.36-.88a1.21 1.21 0 0 0-.86-.37H5.37a.48.48 0 0 0-.35.15.5.5 0 0 0-.14.35v4c0 .13.05.26.14.35.1.1.22.15.35.15h1.96z"
                        fill="#fff"></path>
                    </svg>
                  </span>
                  <p class="text-blue-600 font-medium">Book Author</p>
                </div>
                <p class="mb-4">{authorInfo}</p>
                <p class="border-b border-gray-100 mb-4"></p>
                <div class="flex justify-between">
                  <span class="text-gray-400">
                    {authorFollowersNum} Followers
                  </span>
                  <button
                    type="button"
                    class="text-white font-light bg-green-700 hover:bg-green-800 rounded-full py-0.5 px-2"
                  >
                    Follow
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        {
          publicationName && (
            <>
              <p>in</p>
              <a href="#" class="font-medium text-black ms-1">
                {" "}
                {publicationName}
              </a>
            </>
          )
        }
      </div>
    </div>
    <h6 class="font-bold mb-2">
      <a href="#">{articleTitle}</a>
    </h6>
    <div class="flex gap-1">
      <div class="flex items-center gap-1 text-[13px] text-gray-500 font-light">
        <p>
          {date} Â· {readTime} min read
        </p>
        <a href="#" title="Member-only story">
          <span class={`${isMemberOnly ? "" : "hidden"}`}>
            <svg
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              class="w-4"
            >
              <path
                d="M12.4 12.77l-1.81 4.99a.63.63 0 0 1-1.18 0l-1.8-4.99a.63.63 0 0 0-.38-.37l-4.99-1.81a.62.62 0 0 1 0-1.18l4.99-1.8a.63.63 0 0 0 .37-.38l1.81-4.99a.63.63 0 0 1 1.18 0l1.8 4.99a.63.63 0 0 0 .38.37l4.99 1.81a.63.63 0 0 1 0 1.18l-4.99 1.8a.63.63 0 0 0-.37.38z"
                fill="#FFC017"></path>
            </svg>
          </span>
        </a>
      </div>
      <a href="#" class="hidden">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="w-4">
          <path
            d="M12.4 12.77l-1.81 4.99a.63.63 0 0 1-1.18 0l-1.8-4.99a.63.63 0 0 0-.38-.37l-4.99-1.81a.62.62 0 0 1 0-1.18l4.99-1.8a.63.63 0 0 0 .37-.38l1.81-4.99a.63.63 0 0 1 1.18 0l1.8 4.99a.63.63 0 0 0 .38.37l4.99 1.81a.63.63 0 0 1 0 1.18l-4.99 1.8a.63.63 0 0 0-.37.38z"
            fill="#FFC017"></path>
        </svg>
      </a>
    </div>
  </div>
</li>

<script>
  const handleMouseEnter = (e: MouseEvent) => {
    const element = e.currentTarget as HTMLElement;
    const rect = element.getBoundingClientRect();
    const distanceFromRight = window.innerWidth - rect.right;
    const authorName = element.getAttribute("data-authorName");
    const authorInfo = document.querySelector(
      `[data-authorInfo='${authorName}']`,
    ) as HTMLElement;
    const speechBubble = document.querySelector(
      `[data-authorInfo-speechBubble='${authorName}']`,
    ) as HTMLElement;

    if (distanceFromRight > 400) {
      speechBubble.classList.add("speech-bubble-right");
      authorInfo.classList.remove("hidden");
      authorInfo.classList.add("left-full", "ml-5");
    } else {
      speechBubble.classList.add("speech-bubble-left");
      authorInfo.classList.remove("hidden");
      authorInfo.classList.add("right-full", "mr-3");
    }
  };

  const handleMouseLeave = (e: MouseEvent) => {
    const element = e.currentTarget as HTMLElement;
    const authorName = element.getAttribute("data-authorName");
    const authorInfo = document.querySelector(
      `[data-authorInfo='${authorName}']`,
    ) as HTMLElement;
    const speechBubble = document.querySelector(
      `[data-authorInfo-speechBubble='${authorName}']`,
    ) as HTMLElement;

    authorInfo.classList.add("hidden");
    authorInfo.classList.remove("left-full", "ml-5", "right-full", "mr-3");
    speechBubble.classList.remove("speech-bubble-right", "speech-bubble-left");
  };

  document.querySelectorAll("[data-authorName]").forEach((item) => {
    item.addEventListener("mouseenter", (e) => {
      handleMouseEnter(e as MouseEvent);
    });
    item.addEventListener("mouseleave", (e) => {
      handleMouseLeave(e as MouseEvent);
    });
  });
</script>
